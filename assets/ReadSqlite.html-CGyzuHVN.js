import{_ as s,c as a,b as t,o as p}from"./app-BBGgfQOx.js";const e={};function o(l,n){return p(),a("div",null,[...n[0]||(n[0]=[t(`<h2 id="using-groovy-to-read-sqlite-data" tabindex="-1"><a class="header-anchor" href="#using-groovy-to-read-sqlite-data"><span><strong>Using groovy to read <code>Sqlite</code> data</strong></span></a></h2><p>We can use groovy to read <code>Sqlite</code> data. In the groovy, you can write your customer SQL.</p><div class="language-groovy line-numbers-mode" data-highlighter="prismjs" data-ext="groovy" data-title="groovy"><pre><code><span class="line"><span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>*</span>
<span class="line"><span class="token keyword">import</span> java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span>*</span>
<span class="line"><span class="token keyword">import</span> groovy<span class="token punctuation">.</span>json<span class="token punctuation">.</span>JsonOutput</span>
<span class="line"><span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>nifi<span class="token punctuation">.</span>processor<span class="token punctuation">.</span>io<span class="token punctuation">.</span>StreamCallback</span>
<span class="line"><span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span>StandardCharsets</span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> flowFile <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>flowFile <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token keyword">return</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> _sqliteDbPath <span class="token operator">=</span> Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;path/yourdb.db&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">def</span> conn <span class="token operator">=</span> null</span>
<span class="line"><span class="token keyword">def</span> results <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token keyword">def</span> signalId <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">&quot;sqlitesignal-&quot;</span></span> <span class="token operator">+</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">def</span> signalCount <span class="token operator">=</span> <span class="token number">0</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// Step 1: Connect to the backup database</span></span>
<span class="line">    Class<span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;org.sqlite.JDBC&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">def</span> jdbcUrl <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">&quot;jdbc:sqlite:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">_sqliteDbPath<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&#39;\\\\&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span></span>
<span class="line">    conn <span class="token operator">=</span> DriverManager<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>jdbcUrl<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Step 2: Execute SQL query</span></span>
<span class="line">    <span class="token keyword">def</span> sql <span class="token operator">=</span> <span class="token string">&#39;&#39;&#39;</span>
<span class="line">        Your customer sql in here</span>
<span class="line">    &#39;&#39;&#39;</span></span>
<span class="line">    <span class="token keyword">def</span> stmt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">def</span> rs <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// Step 3: Read result set into map list</span></span>
<span class="line">    <span class="token keyword">def</span> rsMeta <span class="token operator">=</span> rs<span class="token punctuation">.</span>metaData</span>
<span class="line">    <span class="token keyword">def</span> columnCount <span class="token operator">=</span> rsMeta<span class="token punctuation">.</span>columnCount</span>
<span class="line"></span>
<span class="line">    <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">def</span> row <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span></span>
<span class="line">        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> columnCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">def</span> columnName <span class="token operator">=</span> rsMeta<span class="token punctuation">.</span><span class="token function">getColumnLabel</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">            row<span class="token punctuation">[</span>columnName<span class="token punctuation">]</span> <span class="token operator">=</span> rs<span class="token punctuation">.</span><span class="token function">getObject</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        results <span class="token operator">&lt;&lt;</span> row</span>
<span class="line">        signalCount <span class="token operator">++</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    rs<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    stmt<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">    log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;Read Data success&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;Error executing SQLite query: &quot;</span></span><span class="token punctuation">,</span> e<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">throw</span> e</span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>conn <span class="token operator">!=</span> null<span class="token punctuation">)</span> conn<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Step 4: Write the JSON to flowfile content</span></span>
<span class="line">flowFile <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>flowFile<span class="token punctuation">,</span> <span class="token punctuation">{</span> inputStream<span class="token punctuation">,</span> outputStream <span class="token operator">-&gt;</span></span>
<span class="line">    <span class="token keyword">def</span> json <span class="token operator">=</span> JsonOutput<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span></span>
<span class="line">    outputStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span>StandardCharsets<span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">as</span> StreamCallback<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Step 5: Add attributes</span></span>
<span class="line">flowFile <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">putAllAttributes</span><span class="token punctuation">(</span>flowFile<span class="token punctuation">,</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token interpolation-string"><span class="token string">&quot;sqlitesignal.count&quot;</span></span><span class="token punctuation">:</span> signalCount<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token interpolation-string"><span class="token string">&quot;sqlitesignalId&quot;</span></span>    <span class="token punctuation">:</span> signalId</span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">)</span></span>
<span class="line">log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">&quot;putAllAttributes success: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">signalCount</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> records, sqlitesignalId: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token expression">signalId</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span></span>
<span class="line">session<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>flowFile<span class="token punctuation">,</span> REL_SUCCESS<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><p>You also can add the ODBC service in the NIFI <code>Controller services</code>. In this way, you don&#39;t need to read <code>sqlite</code> db file directly.</p>`,5)])])}const i=s(e,[["render",o]]),u=JSON.parse('{"path":"/blogs/ETL/AppacheNIFI/Groovy/ReadSqlite.html","title":"Using groovy to read Sqlite data","lang":"en-US","frontmatter":{"title":"Using groovy to read Sqlite data","date":"2025/11/27","tags":["ApacheNIFI"],"categories":["ETL"]},"headers":[{"level":2,"title":"Using groovy to read Sqlite data","slug":"using-groovy-to-read-sqlite-data","link":"#using-groovy-to-read-sqlite-data","children":[]}],"git":{"createdTime":1764230375000,"updatedTime":1764230375000,"contributors":[{"name":"jsonzhao","email":"json.zhao.cn@outlook.com","commits":1}]},"filePathRelative":"blogs/ETL/AppacheNIFI/Groovy/ReadSqlite.md"}');export{i as comp,u as data};
