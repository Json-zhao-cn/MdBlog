import{_ as l,c as i,b as e,a as t,d as a,e as r,w as o,r as c,o as d}from"./app-B92ljsKh.js";const u={};function p(b,s){const n=c("RouteLink");return d(),i("div",null,[s[2]||(s[2]=e("h1",{id:"using-ag-trigger-to-sync-job-status-in-the-sql-server-alwayson-cluster",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#using-ag-trigger-to-sync-job-status-in-the-sql-server-alwayson-cluster"},[e("span",null,[a("Using "),e("code",null,"AG Trigger"),a(" to "),e("code",null,"Sync Job status"),a(" in the "),e("code",null,"SQL Server Alwayson"),a(" cluster")])])],-1)),e("p",null,[e("strong",null,[s[1]||(s[1]=a("This solution was dispose due to the AG trigger is hard to realize in the SQL Server alwayson. Recommand use add step to check current listener is primary or not.",-1)),r(n,{to:"/blogs/Skills/SQLServer/Job/SyncJobAG.html"},{default:o(()=>[...s[0]||(s[0]=[a("The realize solution",-1)])]),_:1})])]),s[3]||(s[3]=t(`<h1 id="process" tabindex="-1"><a class="header-anchor" href="#process"><span>Process</span></a></h1><div class="language-Text line-numbers-mode" data-highlighter="prismjs" data-ext="Text" data-title="Text"><pre><code><span class="line">    +------------------------------------+</span>
<span class="line">    |       Failover_Job_Status Table    |</span>
<span class="line">    +------------------------------------+</span>
<span class="line">                    |</span>
<span class="line">                    ▼</span>
<span class="line">    +------------------------------------+</span>
<span class="line">    | Usp_syncJobStatus Stored procedure |</span>
<span class="line">    +------------------------------------+</span>
<span class="line">                    |</span>
<span class="line">                    ▼</span>
<span class="line">    +------------------------------------+</span>
<span class="line">    |       sync_JobStatus Job           |</span>
<span class="line">    +------------------------------------+</span>
<span class="line">                    |</span>
<span class="line">                    ▼</span>
<span class="line">    +------------------------------------+</span>
<span class="line">    |      Duplicate all jobs AG Node    |</span>
<span class="line">    +------------------------------------+</span>
<span class="line">                    |</span>
<span class="line">                    ▼</span>
<span class="line">    +------------------------------------+</span>
<span class="line">    |      AG failover trigger           |</span>
<span class="line">    +------------------------------------+</span>
<span class="line">                    |</span>
<span class="line">                    ▼</span>
<span class="line">    +------------------------------------+</span>
<span class="line">    |               Test                 |</span>
<span class="line">    +------------------------------------+</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_1-create-customer-failover-job-status" tabindex="-1"><a class="header-anchor" href="#_1-create-customer-failover-job-status"><span>1. <strong>Create Customer Failover_Job_Status</strong></span></a></h2><p>Create a customer table in your AG Group DB. We call it as AT_AG_JobStatus.</p><div class="language-SQL line-numbers-mode" data-highlighter="prismjs" data-ext="SQL" data-title="SQL"><pre><code><span class="line">CREATE TABLE [dbo].[AT_AG_JobStatus](</span>
<span class="line">	[JobName] [nvarchar](128) NOT NULL,</span>
<span class="line">	[Status] [bit] NOT NULL,</span>
<span class="line">	[IsPrimary] [bit] NULL,</span>
<span class="line">PRIMARY KEY CLUSTERED </span>
<span class="line">(</span>
<span class="line">	[JobName] ASC</span>
<span class="line">)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]</span>
<span class="line">) ON [PRIMARY]</span>
<span class="line">GO</span>
<span class="line"></span>
<span class="line">ALTER TABLE [dbo].[AT_AG_JobStatus] ADD  DEFAULT ((1)) FOR [IsPrimary]</span>
<span class="line">GO</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Field explanation:</p><ul><li><strong>Status</strong>: The job enable or disable</li><li><strong>IsPrimary</strong>: Some jobs like <code>transaction log backup</code> job, it should execute in the secondary replica.If this job didn&#39;t execute in the primary job, and the status is enable, we should maintenance this job manually.Which means we can insert this job into table automatically.</li></ul><h2 id="this-table-will-save-all-job-status-execute-server-in-the-primary-available-group-ag-db" tabindex="-1"><a class="header-anchor" href="#this-table-will-save-all-job-status-execute-server-in-the-primary-available-group-ag-db"><span>This table will save all job status,execute server in the primary (Available Group)AG DB.</span></a></h2><h2 id="_2-create-stored-procedure-to-sync-job-status" tabindex="-1"><a class="header-anchor" href="#_2-create-stored-procedure-to-sync-job-status"><span>2. <strong>Create Stored procedure to sync Job Status</strong></span></a></h2><h2 id="_3-create-job-to-sync-job-status-automatically" tabindex="-1"><a class="header-anchor" href="#_3-create-job-to-sync-job-status-automatically"><span>3. <strong>Create Job to sync Job Status automatically</strong></span></a></h2><h2 id="_4-duplicate-all-jobs-from-master-to-all-slavers" tabindex="-1"><a class="header-anchor" href="#_4-duplicate-all-jobs-from-master-to-all-slavers"><span>4. <strong>Duplicate all jobs from master to all slavers</strong></span></a></h2><h2 id="_5-create-an-availability-group-ag-failover-trigger" tabindex="-1"><a class="header-anchor" href="#_5-create-an-availability-group-ag-failover-trigger"><span>5. <strong>Create an Availability Group (AG) failover trigger</strong></span></a></h2><hr><h3 id="_7-summarize" tabindex="-1"><a class="header-anchor" href="#_7-summarize"><span>7.<strong>Summarize</strong></span></a></h3><ol><li>Hard to realize it;</li><li>The AG trigger in the AG group, sometimes it is hard to trigger. Only primary can trigger.</li></ol><hr>`,17))])}const m=l(u,[["render",p]]),h=JSON.parse('{"path":"/blogs/Skills/SQLServer/Job/AGTriggerSyncJobStatus.html","title":"Using AG Trigger to Sync Job status in the SQL Server Alwayson cluster","lang":"en-US","frontmatter":{"title":"Using AG Trigger to Sync Job status in the SQL Server Alwayson cluster","date":"2025/11/21","tags":["SQLServer"],"categories":["Skills"]},"headers":[{"level":2,"title":"1. Create Customer Failover_Job_Status","slug":"_1-create-customer-failover-job-status","link":"#_1-create-customer-failover-job-status","children":[]},{"level":2,"title":"This table will save all job status,execute server in the primary (Available Group)AG DB.","slug":"this-table-will-save-all-job-status-execute-server-in-the-primary-available-group-ag-db","link":"#this-table-will-save-all-job-status-execute-server-in-the-primary-available-group-ag-db","children":[]},{"level":2,"title":"2. Create Stored procedure to sync Job Status","slug":"_2-create-stored-procedure-to-sync-job-status","link":"#_2-create-stored-procedure-to-sync-job-status","children":[]},{"level":2,"title":"3. Create Job to sync Job Status automatically","slug":"_3-create-job-to-sync-job-status-automatically","link":"#_3-create-job-to-sync-job-status-automatically","children":[]},{"level":2,"title":"4. Duplicate all jobs from master to all slavers","slug":"_4-duplicate-all-jobs-from-master-to-all-slavers","link":"#_4-duplicate-all-jobs-from-master-to-all-slavers","children":[]},{"level":2,"title":"5. Create an Availability Group (AG) failover trigger","slug":"_5-create-an-availability-group-ag-failover-trigger","link":"#_5-create-an-availability-group-ag-failover-trigger","children":[{"level":3,"title":"7.Summarize","slug":"_7-summarize","link":"#_7-summarize","children":[]}]}],"git":{"createdTime":1763986628000,"updatedTime":1765872635000,"contributors":[{"name":"jsonzhao","email":"json.zhao.cn@outlook.com","commits":4},{"name":"json zhao","email":"json.zhao.cn@outlook.com","commits":2}]},"filePathRelative":"blogs/Skills/SQLServer/Job/AGTriggerSyncJobStatus.md"}');export{m as comp,h as data};
