import{_ as n,c as a,a as e,o as p}from"./app-HoY_AqEo.js";const l={};function t(o,s){return p(),a("div",null,[...s[0]||(s[0]=[e(`<h2 id="batch-delete-data-in-the-sql-server" tabindex="-1"><a class="header-anchor" href="#batch-delete-data-in-the-sql-server"><span><strong><code>Batch delete</code> data in the SQL Server</strong></span></a></h2><h4 id="_1-common-method" tabindex="-1"><a class="header-anchor" href="#_1-common-method"><span>1. <strong>Common method</strong></span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> TableA</span>
<span class="line"><span class="token keyword">WHERE</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">SELECT</span> <span class="token number">1</span> <span class="token keyword">FROM</span> TableB </span>
<span class="line">    <span class="token keyword">WHERE</span> B<span class="token punctuation">.</span>Id <span class="token operator">=</span> A<span class="token punctuation">.</span>Id</span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">AND</span> A<span class="token punctuation">.</span>LastUpdateTime <span class="token operator">&lt;</span> DATEADD<span class="token punctuation">(</span><span class="token keyword">day</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h4 id="_2-big-table" tabindex="-1"><a class="header-anchor" href="#_2-big-table"><span>2. <strong>Big table</strong></span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">DELETE</span> TableA</span>
<span class="line"><span class="token keyword">FROM</span> A</span>
<span class="line"><span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> TableB <span class="token keyword">ON</span> A<span class="token punctuation">.</span>Id <span class="token operator">=</span> B<span class="token punctuation">.</span>Id</span>
<span class="line"><span class="token keyword">WHERE</span> B<span class="token punctuation">.</span>Id <span class="token operator">IS</span> <span class="token boolean">NULL</span></span>
<span class="line"><span class="token operator">AND</span> A<span class="token punctuation">.</span>LastUpdateTime <span class="token operator">&lt;</span> DATEADD<span class="token punctuation">(</span><span class="token keyword">day</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h4 id="_3-large-table" tabindex="-1"><a class="header-anchor" href="#_3-large-table"><span>3. <strong>Large table</strong></span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token comment">-- Create temp table with index (much faster join lookups)</span></span>
<span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token comment">#TempToDelete</span></span>
<span class="line"><span class="token punctuation">(</span></span>
<span class="line">    Id <span class="token keyword">BIGINT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- Populate IDs to delete</span></span>
<span class="line"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token comment">#TempToDelete (Id)</span></span>
<span class="line"><span class="token keyword">SELECT</span> A<span class="token punctuation">.</span>Id</span>
<span class="line"><span class="token keyword">FROM</span> TableA A</span>
<span class="line"><span class="token keyword">WHERE</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">SELECT</span> <span class="token number">1</span></span>
<span class="line">    <span class="token keyword">FROM</span> WAREHOUSE_LOCATION_View B</span>
<span class="line">    <span class="token keyword">WHERE</span> B<span class="token punctuation">.</span>Id <span class="token operator">=</span> A<span class="token punctuation">.</span>Id</span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token operator">AND</span> A<span class="token punctuation">.</span>LastUpdateOn <span class="token operator">&gt;</span> <span class="token string">&#39;DateTime&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">-- Batch delete in chunks</span></span>
<span class="line"><span class="token keyword">WHILE</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">DELETE</span> <span class="token keyword">TOP</span> <span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span> A</span>
<span class="line">    <span class="token keyword">FROM</span> TableA A</span>
<span class="line">    <span class="token keyword">JOIN</span> <span class="token comment">#TempToDelete T ON A.Id = T.Id;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">DELETE</span> <span class="token keyword">TOP</span> <span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> <span class="token comment">#TempToDelete;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">IF</span> @<span class="token variable">@ROWCOUNT</span> <span class="token operator">=</span> <span class="token number">0</span> <span class="token keyword">BREAK</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token comment">#TempToDelete;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h4 id="_4-truncate-table" tabindex="-1"><a class="header-anchor" href="#_4-truncate-table"><span>4. <strong>truncate table</strong></span></a></h4><p>If you want to delete the table data, and didn&#39;t want to keep transaction log. You can use <code>truncate table</code> SQL script.</p><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">truncate</span> <span class="token keyword">table</span> YourTable<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,13)])])}const i=n(l,[["render",t]]),r=JSON.parse('{"path":"/blogs/Skills/SQLServer/Funcation/BatchDelete.html","title":"Batch delete data in the SQL Server","lang":"en-US","frontmatter":{"title":"Batch delete data in the SQL Server","date":"2025/11/27","tags":["SQLServer"],"categories":["Skills"]},"headers":[{"level":2,"title":"Batch delete data in the SQL Server","slug":"batch-delete-data-in-the-sql-server","link":"#batch-delete-data-in-the-sql-server","children":[]}],"git":{"createdTime":1764228007000,"updatedTime":1764228007000,"contributors":[{"name":"jsonzhao","email":"json.zhao.cn@outlook.com","commits":1}]},"filePathRelative":"blogs/Skills/SQLServer/Funcation/BatchDelete.md"}');export{i as comp,r as data};
