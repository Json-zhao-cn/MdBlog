<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.19">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <title>Sync Job status in the SQL Server Alwayson cluster solution | Manifacturing Industry Blog</title><meta name="description" content="This is a blog for manufacturing industry, some experiences just for json zhao.">
    <link rel="preload" href="/MdBlog/assets/style-DRXNKcOj.css" as="style"><link rel="stylesheet" href="/MdBlog/assets/style-DRXNKcOj.css">
    <link rel="modulepreload" href="/MdBlog/assets/app-yROusAoE.js"><link rel="modulepreload" href="/MdBlog/assets/SyncJobAG.html-CjwpZppr.js">
    <link rel="prefetch" href="/MdBlog/assets/timeline.html-Cx9M4K5w.js" as="script"><link rel="prefetch" href="/MdBlog/assets/posts.html-B4H9EHxB.js" as="script"><link rel="prefetch" href="/MdBlog/assets/friendship-link.html-BBpe3Glt.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-Bav15Ilq.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-BjJySf8_.js" as="script"><link rel="prefetch" href="/MdBlog/assets/2.html-BU6dLkqY.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-ChOn67g3.js" as="script"><link rel="prefetch" href="/MdBlog/assets/2.html-Cr3Ssspt.js" as="script"><link rel="prefetch" href="/MdBlog/assets/3.html-DvVnMu8x.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-DjU5vXYC.js" as="script"><link rel="prefetch" href="/MdBlog/assets/2.html-CkfROp5Z.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-CmGRTotJ.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-DRoG0Gg8.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-DpJmibz-.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-DJY1KfsL.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-rDy6aX8M.js" as="script"><link rel="prefetch" href="/MdBlog/assets/2.html-T4YG-whL.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-BVBV_r2o.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-B2gFSkLZ.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-D6yrgD6j.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-Bz8Xv-ZL.js" as="script"><link rel="prefetch" href="/MdBlog/assets/2.html-BF9vryJl.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-DGhLMIqi.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-Q1pbymSm.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-Dr5lB7yM.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-CcD6_g_t.js" as="script"><link rel="prefetch" href="/MdBlog/assets/2.html-DBf6kZu7.js" as="script"><link rel="prefetch" href="/MdBlog/assets/3.html-ceeJiK-M.js" as="script"><link rel="prefetch" href="/MdBlog/assets/4.html-8s46TDdK.js" as="script"><link rel="prefetch" href="/MdBlog/assets/5.html-BTAeeJEY.js" as="script"><link rel="prefetch" href="/MdBlog/assets/6.html-wCVouUM6.js" as="script"><link rel="prefetch" href="/MdBlog/assets/index.html-BAHuQ4Zs.js" as="script"><link rel="prefetch" href="/MdBlog/assets/ElasticsearchIntroduce.html-PbJRH-0Z.js" as="script"><link rel="prefetch" href="/MdBlog/assets/ELKSimpeIntroduce.html-D-vKeBKp.js" as="script"><link rel="prefetch" href="/MdBlog/assets/FilebeatIntroduce.html-BRb0mzBX.js" as="script"><link rel="prefetch" href="/MdBlog/assets/KibanaIntroduce.html-Q1NbPOAx.js" as="script"><link rel="prefetch" href="/MdBlog/assets/LogstashIntroduce.html-Dr6QBPEQ.js" as="script"><link rel="prefetch" href="/MdBlog/assets/guide.html-BALKfHPM.js" as="script"><link rel="prefetch" href="/MdBlog/assets/api.html-pVQY8JbO.js" as="script"><link rel="prefetch" href="/MdBlog/assets/home.html-pX3oUpkV.js" as="script"><link rel="prefetch" href="/MdBlog/assets/plugin.html-DM1a4rOQ.js" as="script"><link rel="prefetch" href="/MdBlog/assets/theme.html-C0tZSMlV.js" as="script"><link rel="prefetch" href="/MdBlog/assets/NssmCommand.html-DenHgn4n.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1FactoryThreeSystems.html-C_sNQ_wJ.js" as="script"><link rel="prefetch" href="/MdBlog/assets/2What_is_MES.html-AzbQV1G3.js" as="script"><link rel="prefetch" href="/MdBlog/assets/3MESCoreFunction.html-DHE8Ir6o.js" as="script"><link rel="prefetch" href="/MdBlog/assets/CompairvsSQLServerSSIS.html-CIF-zQiC.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.What_is_WMS.html-C--iG150.js" as="script"><link rel="prefetch" href="/MdBlog/assets/NET8Introduce.html-jbknNmDi.js" as="script"><link rel="prefetch" href="/MdBlog/assets/ExportData.html-D3jlYPEw.js" as="script"><link rel="prefetch" href="/MdBlog/assets/TableDataCompare.html-DDq_dtsS.js" as="script"><link rel="prefetch" href="/MdBlog/assets/SqliteCommSql.html-BaSQIrTO.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1Scope.html-DgT8GtVH.js" as="script"><link rel="prefetch" href="/MdBlog/assets/2Requirement.html-DtdrOjIW.js" as="script"><link rel="prefetch" href="/MdBlog/assets/10Test.html-Dj597_1p.js" as="script"><link rel="prefetch" href="/MdBlog/assets/11Execute.html-CHhGmA-V.js" as="script"><link rel="prefetch" href="/MdBlog/assets/12Maintenance.html-Czf1pzV9.js" as="script"><link rel="prefetch" href="/MdBlog/assets/13Monitor.html-D9UI2UMk.js" as="script"><link rel="prefetch" href="/MdBlog/assets/14Optimize.html-zJdV7SsR.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1Scope.html-BFvj0aV3.js" as="script"><link rel="prefetch" href="/MdBlog/assets/2Requirement.html-Dgun3c25.js" as="script"><link rel="prefetch" href="/MdBlog/assets/3TechnologySelection.html-93EDmz11.js" as="script"><link rel="prefetch" href="/MdBlog/assets/4Resource.html-lYtjsMBy.js" as="script"><link rel="prefetch" href="/MdBlog/assets/5Evaluate.html-5otEH8H3.js" as="script"><link rel="prefetch" href="/MdBlog/assets/6Plan.html-CMzUVyZN.js" as="script"><link rel="prefetch" href="/MdBlog/assets/7Analyse.html-Qh9hWGqw.js" as="script"><link rel="prefetch" href="/MdBlog/assets/8Design.html-D8aYe7Ox.js" as="script"><link rel="prefetch" href="/MdBlog/assets/9Dev.html-0ioMMxIO.js" as="script"><link rel="prefetch" href="/MdBlog/assets/ConnectSQLServerAG.html-DTuFnSxl.js" as="script"><link rel="prefetch" href="/MdBlog/assets/NIFI1.2.8Version.html-C_bpY-id.js" as="script"><link rel="prefetch" href="/MdBlog/assets/NIFI2.4.0Version.html-DS2jmvmy.js" as="script"><link rel="prefetch" href="/MdBlog/assets/CheckJsonIsNull.html-CAdFlWB9.js" as="script"><link rel="prefetch" href="/MdBlog/assets/PareseComplexJson.html-CzaCPJli.js" as="script"><link rel="prefetch" href="/MdBlog/assets/ParseJson.html-CqFMCcy8.js" as="script"><link rel="prefetch" href="/MdBlog/assets/QueueDelay.html-BSHI-uhb.js" as="script"><link rel="prefetch" href="/MdBlog/assets/SplitJson.html-B-9--1F2.js" as="script"><link rel="prefetch" href="/MdBlog/assets/RowVersion_en.html-D0D_9cDl.js" as="script"><link rel="prefetch" href="/MdBlog/assets/cdcImplement.html-BIuYYwBf.js" as="script"><link rel="prefetch" href="/MdBlog/assets/ModifyCDCTable.html-2wumF35t.js" as="script"><link rel="prefetch" href="/MdBlog/assets/SQL Server CDC Table Explain.html-D6E72Tsc.js" as="script"><link rel="prefetch" href="/MdBlog/assets/AF_XmlToJson.html-Ce6lFX3B.js" as="script"><link rel="prefetch" href="/MdBlog/assets/DeepUnderstandingMerge.html-DSPTKXFs.js" as="script"><link rel="prefetch" href="/MdBlog/assets/MergeFuncation.html-CPKbiWGl.js" as="script"><link rel="prefetch" href="/MdBlog/assets/IndexCreate.html-BsTA2PhL.js" as="script"><link rel="prefetch" href="/MdBlog/assets/AGTriggerSyncJobStatus.html-DVnkFa2R.js" as="script"><link rel="prefetch" href="/MdBlog/assets/KeysetPagination.html-D4NLc66P.js" as="script"><link rel="prefetch" href="/MdBlog/assets/Page_offsetPerformance.html-pZXm61ZE.js" as="script"><link rel="prefetch" href="/MdBlog/assets/SSMSConnectAG.html-MPtf90qx.js" as="script"><link rel="prefetch" href="/MdBlog/assets/ExecProcedure.html-D_NGvm-b.js" as="script"><link rel="prefetch" href="/MdBlog/assets/usp_GetCDCQueryStartMode.html-BcAICVbt.js" as="script"><link rel="prefetch" href="/MdBlog/assets/usp_GetCdcTableData.html-B8TTJVRz.js" as="script"><link rel="prefetch" href="/MdBlog/assets/usp_UpdateNextCDCTraceData.html-Bbul3dZ9.js" as="script"><link rel="prefetch" href="/MdBlog/assets/CreateTable.html-Db83b7b_.js" as="script"><link rel="prefetch" href="/MdBlog/assets/GetDatabaseTableScript.html-C9ZCixDL.js" as="script"><link rel="prefetch" href="/MdBlog/assets/UpdateDifferentTable.html-CoYn-ftk.js" as="script"><link rel="prefetch" href="/MdBlog/assets/404.html-05PV_BJe.js" as="script"><link rel="prefetch" href="/MdBlog/assets/Valine.min-_LyT3bfY.js" as="script"><link rel="prefetch" href="/MdBlog/assets/giscus-aTimukGI-DWEKOTfS.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container series--no show-catalog"><header class="navbar-container not-open"><div class="navbar-inner"><div class="site-brand nav-item"><img class="logo" src="/MdBlog/logo.png" alt="Manifacturing Industry Blog"><a href="/MdBlog/" class="site-name can-hide">Manifacturing Industry Blog</a></div><div class="nav-item navbar-links-wrapper" style=""><div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div><nav class="navbar-links"><!--[--><div class="navbar-links__item"><a href="/MdBlog/" class="link" aria-label="Home"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Home<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/MdBlog/categories/Skills/1.html" class="link" aria-label="Skills"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Skills<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/MdBlog/categories/ELK/1.html" class="link" aria-label="ELK"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->ELK<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/MdBlog/categories/ETL/1.html" class="link" aria-label="ETL"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->ETL<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/MdBlog/categories/MES/1.html" class="link" aria-label="MES"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->MES<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/MdBlog/categories/WMS/1.html" class="link" aria-label="WMS"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->WMS<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/MdBlog/categories/Project/1.html" class="link" aria-label="Project"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Project<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/MdBlog/tags/SQLServer/1.html" class="link" aria-label="Tags"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Tags<!--]--></span></span><!--[--><!--]--></a></div><!--]--><!----><span class="xicon-container btn-toggle-dark-mode btn--dark-mode navbar-links__item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span><ul class="social-links navbar-links__item"><!--[--><!--]--></ul></nav><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div></div></header><!----><!----><!----><div class="theme-main" style=""><!----><!--[--><main class="page-container"><div class="page-content"><h1 class="page-title">Sync Job status in the SQL Server Alwayson cluster solution</h1><div class="page-info"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->json zhao<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2025/11/21<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/MdBlog/categories/Skills/1.html" class="">Skills</a><!--]--><!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M10 14a4 4 0 1 1 4-4a4.005 4.005 0 0 1-4 4zm0-6a2 2 0 1 0 1.998 2.004A2.002 2.002 0 0 0 10 8z" fill="currentColor"></path><path d="M16.644 29.415L2.586 15.354A2 2 0 0 1 2 13.941V4a2 2 0 0 1 2-2h9.941a2 2 0 0 1 1.414.586l14.06 14.058a2 2 0 0 1 0 2.828l-9.943 9.943a2 2 0 0 1-2.829 0zM4 4v9.942L18.058 28L28 18.058L13.942 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/MdBlog/tags/SQLServer/1.html" class="">SQLServer</a><!--]--><!--]--></span></span><!----></div><div class="theme-reco-md-content"><div><h2 id="sync-job-status-in-the-sql-server-alwayson-cluster-solution" tabindex="-1"><a class="header-anchor" href="#sync-job-status-in-the-sql-server-alwayson-cluster-solution"><span><strong>Sync Job status in the SQL Server Alwayson cluster solution</strong></span></a></h2><h3 id="_1-scenario-requirement" tabindex="-1"><a class="header-anchor" href="#_1-scenario-requirement"><span>1. <strong>Scenario(<code>Requirement</code>)</strong></span></a></h3><p>In the SQL Server Availability Group(<code>AG</code>),when the AG changes failover,the primary server has become secondary server,in the meantime, the second server has become the primary server. In the master and slaver change roles.However, the CDC and other business jobs didn&#39;t register or run when the role changed. That&#39;s mean some businesses like PowerBI(<code>PB</code>) will stop, the sync data(<code>CDC</code>) will lose data. What should we do to stop this thing happened?</p><p><img src="/MdBlog/assets/Jobs-DeWL77gP.png" alt="Jobs"></p><h3 id="_2-solution" tabindex="-1"><a class="header-anchor" href="#_2-solution"><span>2. <strong>Solution</strong></span></a></h3><p>We have two ways to prevent this thing happens.We have two options:</p><h4 id="_1-use-customer-stored-procedure-usp-checkserverrole-to-check-the-server-role-is-primary-or-not" tabindex="-1"><a class="header-anchor" href="#_1-use-customer-stored-procedure-usp-checkserverrole-to-check-the-server-role-is-primary-or-not"><span>1. Use customer stored procedure <code>Usp_CheckServerRole</code> to check the server role is primary or not.</span></a></h4><ul><li>Dupilcate all jobs in the all availability group.</li><li>Create the customer stored procedure <code>Usp_CheckServerRole</code></li></ul><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">(</span></span>
<span class="line">    <span class="token keyword">SELECT</span> <span class="token number">1</span> </span>
<span class="line">    <span class="token keyword">FROM</span> sys<span class="token punctuation">.</span>dm_hadr_availability_replica_states rs</span>
<span class="line">    <span class="token keyword">JOIN</span> sys<span class="token punctuation">.</span>availability_replicas ar <span class="token keyword">ON</span> rs<span class="token punctuation">.</span>replica_id <span class="token operator">=</span> ar<span class="token punctuation">.</span>replica_id</span>
<span class="line">    <span class="token keyword">WHERE</span> rs<span class="token punctuation">.</span>is_local <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">AND</span> rs<span class="token punctuation">.</span>role_desc <span class="token operator">=</span> <span class="token string">&#39;PRIMARY&#39;</span></span>
<span class="line">    <span class="token operator">AND</span> ar<span class="token punctuation">.</span>replica_server_name <span class="token operator">=</span> @<span class="token variable">@SERVERNAME</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">PRINT</span> <span class="token string">&#39;The current server is not primary server&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">RETURN</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">END</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Each job step will add <code>Exec Usp_CheckServerRole</code> as first step</li><li>If the server is primary server, next, execute your business job.Otherwise,print error message.</li></ul><h4 id="_2-use-ag-trigger-ag-job-trigger-to-check-the-server-role-is-primary-or-not" tabindex="-1"><a class="header-anchor" href="#_2-use-ag-trigger-ag-job-trigger-to-check-the-server-role-is-primary-or-not"><span>2. Use AG Trigger <code>ag_job_trigger</code> to check the server role is primary or not.</span></a></h4><ul><li><a class="route-link" href="/MdBlog/blogs/Skills/SQLServer/Job/AGTriggerSyncJobStatus.html">Using AG Trigger to Sync Job status in the SQL Server Alwayson cluster</a></li></ul><h3 id="_3-solution-compare" tabindex="-1"><a class="header-anchor" href="#_3-solution-compare"><span>3.<strong>Solution Compare</strong></span></a></h3><table><thead><tr><th>characteristic</th><th>Usp_CheckServerRole</th><th>ag_job_trigger</th></tr></thead><tbody><tr><td><strong>Solution complexity</strong></td><td>❌ <strong>complicated</strong> - add step when create each job step</td><td>✅ <strong>easy</strong> - create and maintain ag_job_trigger</td></tr><tr><td><strong>Job Role Management</strong></td><td>❌ <strong>manual</strong> - need to check each job status</td><td>✅ <strong>Automatic</strong> - Zero downtime for job handling</td></tr><tr><td><strong>SQL Agent Job History</strong></td><td>❌ <strong>noise</strong> - each job in the secondary server will generate useless history</td><td>✅ <strong>No Noise</strong> - no useless alter message</td></tr><tr><td><strong>Consistent Job State</strong></td><td>⚠️ <strong>Low</strong> - <br> • No job list<br> • No same enable/disable status<br>• Manual maintain job logic</td><td>✅ <strong>High</strong> <br> • The same job list<br> • The same enable/disable status<br>• The same logic</td></tr><tr><td><strong>CDC Job</strong></td><td>❌ <strong>low</strong> <br> Each server will execute job<br> Loss data <br>No failover recovery</td><td>✅ <strong>High</strong> <br> Ensures CDC capture jobs only run on the primary<br>Prevents CDC data loss caused by missing jobs on the new primary<br>Simplifies CDC failover recovery</td></tr><tr><td><strong>Safty</strong></td><td>• Each node will trigger job</td><td>• New primary automatically takes job workload<br>• Old primary automatically stops job workload</td></tr><tr><td><strong>Control</strong></td><td>Manual control</td><td>Centralized control</td></tr><tr><td><strong>Scales</strong></td><td>Less than Hundred jobs</td><td>Hundreds or Thousands of Jobs</td></tr><tr><td><strong>scenarios</strong></td><td>Development ,Test &amp; Small application</td><td>Enterprise</td></tr></tbody></table><h3 id="_4-summarize" tabindex="-1"><a class="header-anchor" href="#_4-summarize"><span>4.<strong>Summarize</strong></span></a></h3><p>Compare to use customer procedure<code>Usp_CheckServerRole</code>,<code>ag_job_trigger</code> is suit for the enterprise production environment.It has high scalability to control the job status, logic.The most importantly, when we use <code>CDC</code> service to sync data from source db to target db. We cannot tolerate the risk of data loss.So, we must use <code>ag_job_trigger</code> to control <code>CDC</code> jobs.This is mandtary, not optional.</p></div></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Last Updated 2025/11/24 22:04:16<!--]--></span></span></div></footer><!----><!----></div><div class="page-catalog-container"><h5 class="tip">ON THIS PAGE</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/MdBlog/blogs/Skills/SQLServer/Job/SyncJobAG.html#sync-job-status-in-the-sql-server-alwayson-cluster-solution" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Sync Job status in the SQL Server Alwayson cluster solution"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Sync Job status in the SQL Server Alwayson cluster solution<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/MdBlog/blogs/Skills/SQLServer/Job/SyncJobAG.html#_1-scenario-requirement" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1. Scenario(Requirement)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1. Scenario(Requirement)<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/MdBlog/blogs/Skills/SQLServer/Job/SyncJobAG.html#_2-solution" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2. Solution"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2. Solution<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/MdBlog/blogs/Skills/SQLServer/Job/SyncJobAG.html#_3-solution-compare" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="3.Solution Compare"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3.Solution Compare<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/MdBlog/blogs/Skills/SQLServer/Job/SyncJobAG.html#_4-summarize" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="4.Summarize"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->4.Summarize<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--]--></ul></div></main><!--]--></div></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/MdBlog/assets/app-yROusAoE.js" defer></script>
  </body>
</html>
