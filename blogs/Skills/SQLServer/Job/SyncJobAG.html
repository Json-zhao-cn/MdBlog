<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.19">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <title>Sync Job status in the SQL Server Alwayson cluster solution | Manifacturing Industry Blog</title><meta name="description" content="This is a blog for manufacturing industry, some experiences just for json zhao.">
    <link rel="preload" href="/MdBlog/assets/style-BGOzhkfr.css" as="style"><link rel="stylesheet" href="/MdBlog/assets/style-BGOzhkfr.css">
    <link rel="modulepreload" href="/MdBlog/assets/app-BbnCYvRy.js"><link rel="modulepreload" href="/MdBlog/assets/SyncJobAG.html-DZDPf7rk.js">
    <link rel="prefetch" href="/MdBlog/assets/timeline.html-BFJ1L7ID.js" as="script"><link rel="prefetch" href="/MdBlog/assets/posts.html-DebpDJLJ.js" as="script"><link rel="prefetch" href="/MdBlog/assets/friendship-link.html-BvrsGlIc.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-CshlUAgt.js" as="script"><link rel="prefetch" href="/MdBlog/assets/2.html-B3Z0mwUV.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-B0B1pFNr.js" as="script"><link rel="prefetch" href="/MdBlog/assets/2.html-xoDmoDCR.js" as="script"><link rel="prefetch" href="/MdBlog/assets/3.html-DMMX08X1.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-DkD4V1zm.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-B4D8dPBF.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-CQxuof-J.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-DLdB1rjk.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-Bg7BNVpT.js" as="script"><link rel="prefetch" href="/MdBlog/assets/2.html-BY6OkNP_.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-CU7b9dyp.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-dFf_FhEl.js" as="script"><link rel="prefetch" href="/MdBlog/assets/2.html-CIdLDzl2.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-bVXPr1oz.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-DWqqSUBQ.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-tudLiMXa.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-Tl7MEZHK.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-B-tctX-1.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html--UiqjpYP.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.html-CnT2Q3bs.js" as="script"><link rel="prefetch" href="/MdBlog/assets/2.html-DBgVzxlj.js" as="script"><link rel="prefetch" href="/MdBlog/assets/3.html-rZ1m7A5f.js" as="script"><link rel="prefetch" href="/MdBlog/assets/4.html-W3lD9d5g.js" as="script"><link rel="prefetch" href="/MdBlog/assets/5.html-BX7N16eP.js" as="script"><link rel="prefetch" href="/MdBlog/assets/6.html-DM02JI_-.js" as="script"><link rel="prefetch" href="/MdBlog/assets/index.html-B_6cgAJZ.js" as="script"><link rel="prefetch" href="/MdBlog/assets/ElasticsearchIntroduce.html-W7FGF1u7.js" as="script"><link rel="prefetch" href="/MdBlog/assets/ELKSimpeIntroduce.html-BDm8o0ZK.js" as="script"><link rel="prefetch" href="/MdBlog/assets/FilebeatIntroduce.html-txDMHc-W.js" as="script"><link rel="prefetch" href="/MdBlog/assets/KibanaIntroduce.html-B9qs40-O.js" as="script"><link rel="prefetch" href="/MdBlog/assets/LogstashIntroduce.html-9QFf0QFX.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1FactoryThreeSystems.html-CKfB62A1.js" as="script"><link rel="prefetch" href="/MdBlog/assets/2What_is_MES.html-VpK16tCx.js" as="script"><link rel="prefetch" href="/MdBlog/assets/3MESCoreFunction.html-ptrTc8bZ.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1.What_is_WMS.html-DLXaGlqT.js" as="script"><link rel="prefetch" href="/MdBlog/assets/NssmCommand.html-CPKSvF94.js" as="script"><link rel="prefetch" href="/MdBlog/assets/NSSMNifi.html-C95h5gaz.js" as="script"><link rel="prefetch" href="/MdBlog/assets/CompairvsSQLServerSSIS.html-C-ie0Qv9.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1Scope.html-mmfWHepC.js" as="script"><link rel="prefetch" href="/MdBlog/assets/2Requirement.html-CsdTyzVh.js" as="script"><link rel="prefetch" href="/MdBlog/assets/NET8Introduce.html-DnlmGVqU.js" as="script"><link rel="prefetch" href="/MdBlog/assets/ExportData.html-jB2_Oit5.js" as="script"><link rel="prefetch" href="/MdBlog/assets/TableDataCompare.html-BVL4atK9.js" as="script"><link rel="prefetch" href="/MdBlog/assets/SqliteCommSql.html-DtAnDgqj.js" as="script"><link rel="prefetch" href="/MdBlog/assets/10Test.html-a9CU1jWi.js" as="script"><link rel="prefetch" href="/MdBlog/assets/11Execute.html-_MXzaI95.js" as="script"><link rel="prefetch" href="/MdBlog/assets/12Maintenance.html-vAopnH0h.js" as="script"><link rel="prefetch" href="/MdBlog/assets/13Monitor.html-CHbvn_D9.js" as="script"><link rel="prefetch" href="/MdBlog/assets/14Optimize.html-CbbfPgEv.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1Scope.html-Ca263-DV.js" as="script"><link rel="prefetch" href="/MdBlog/assets/2Requirement.html-CruDhDyO.js" as="script"><link rel="prefetch" href="/MdBlog/assets/3TechnologySelection.html-BG2HhycZ.js" as="script"><link rel="prefetch" href="/MdBlog/assets/4Resource.html-D9ptKExU.js" as="script"><link rel="prefetch" href="/MdBlog/assets/5Evaluate.html-BaXUYt9C.js" as="script"><link rel="prefetch" href="/MdBlog/assets/6Plan.html-D39yDX3X.js" as="script"><link rel="prefetch" href="/MdBlog/assets/7Analyse.html-DdY6oGGv.js" as="script"><link rel="prefetch" href="/MdBlog/assets/8Design.html-rcFpuwgH.js" as="script"><link rel="prefetch" href="/MdBlog/assets/9Dev.html-BN1x0H3_.js" as="script"><link rel="prefetch" href="/MdBlog/assets/10SplitJson.html-Cgxh_erM.js" as="script"><link rel="prefetch" href="/MdBlog/assets/11EvaluateJsonPath.html-D6Rbleaw.js" as="script"><link rel="prefetch" href="/MdBlog/assets/12RouteOnAttribute.html-Cc3J_ZCd.js" as="script"><link rel="prefetch" href="/MdBlog/assets/13RouteOnContent.html-Dst0e9EO.js" as="script"><link rel="prefetch" href="/MdBlog/assets/14MergeContent.html-BFgnkrZV.js" as="script"><link rel="prefetch" href="/MdBlog/assets/15ReplaceText.html-DzMq4eK9.js" as="script"><link rel="prefetch" href="/MdBlog/assets/16PutSQL.html-Cvoj9X8H.js" as="script"><link rel="prefetch" href="/MdBlog/assets/17PutDatabaseRecord.html-CImj80Qy.js" as="script"><link rel="prefetch" href="/MdBlog/assets/18InvokeHTTP.html-DtmDGPO5.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1Group.html-o6pBRaap.js" as="script"><link rel="prefetch" href="/MdBlog/assets/2Controller-services.html-Dnut4-5u.js" as="script"><link rel="prefetch" href="/MdBlog/assets/3InputAndOutPort.html-Bu6zXqJ9.js" as="script"><link rel="prefetch" href="/MdBlog/assets/4UpdateAttribute.html-DVlq8Gxj.js" as="script"><link rel="prefetch" href="/MdBlog/assets/5LogMessage.html-hJEwZvAJ.js" as="script"><link rel="prefetch" href="/MdBlog/assets/6ExecuteSQL.html-BhsmjWU_.js" as="script"><link rel="prefetch" href="/MdBlog/assets/7ConvertAvroToJSON.html-D9b4Yvl-.js" as="script"><link rel="prefetch" href="/MdBlog/assets/8ExecuteSQLRecord.html-DqO4CY4P.js" as="script"><link rel="prefetch" href="/MdBlog/assets/9ConvertRecord.html-CAjJOWVr.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1WhyNifi.html-DZjKkPSx.js" as="script"><link rel="prefetch" href="/MdBlog/assets/NIFI1.2.8Version.html-BXqLqy05.js" as="script"><link rel="prefetch" href="/MdBlog/assets/NIFI2.3.0Version.html-DkWp1BIG.js" as="script"><link rel="prefetch" href="/MdBlog/assets/NifianonymousLogin.html-DRDz1jQP.js" as="script"><link rel="prefetch" href="/MdBlog/assets/1ConnectSQLServerAG.html-COW0q1tn.js" as="script"><link rel="prefetch" href="/MdBlog/assets/2CommonFuncationInNifi.html-DMnEg4OT.js" as="script"><link rel="prefetch" href="/MdBlog/assets/3CornFuncation.html-DYQ07RF3.js" as="script"><link rel="prefetch" href="/MdBlog/assets/CheckJsonIsNull.html-Di977o-Z.js" as="script"><link rel="prefetch" href="/MdBlog/assets/PareseComplexJson.html-CawvtLy3.js" as="script"><link rel="prefetch" href="/MdBlog/assets/ParseJson.html-BMMx9_sp.js" as="script"><link rel="prefetch" href="/MdBlog/assets/QueueDelay.html-CgLu8Wvz.js" as="script"><link rel="prefetch" href="/MdBlog/assets/ReadSqlite.html-BgyyBVBw.js" as="script"><link rel="prefetch" href="/MdBlog/assets/SplitJson.html-DIii8aP-.js" as="script"><link rel="prefetch" href="/MdBlog/assets/DateTimeExtension.html-Cxbb2yvp.js" as="script"><link rel="prefetch" href="/MdBlog/assets/EntryptExtension.html-CoAIpfqQ.js" as="script"><link rel="prefetch" href="/MdBlog/assets/RowVersion_en.html-BpkXkLVO.js" as="script"><link rel="prefetch" href="/MdBlog/assets/cdcImplement.html-DCbnph4A.js" as="script"><link rel="prefetch" href="/MdBlog/assets/ModifyCDCTable.html-VzyZhHyH.js" as="script"><link rel="prefetch" href="/MdBlog/assets/SQL Server CDC Table Explain.html-BsE8zyKI.js" as="script"><link rel="prefetch" href="/MdBlog/assets/AF_XmlToJson.html-D9Cw4qju.js" as="script"><link rel="prefetch" href="/MdBlog/assets/BatchDelete.html-IxwQB0q6.js" as="script"><link rel="prefetch" href="/MdBlog/assets/DeepUnderstandingMerge.html-o4Ds7-ey.js" as="script"><link rel="prefetch" href="/MdBlog/assets/MergeFuncation.html-CNHpKfwX.js" as="script"><link rel="prefetch" href="/MdBlog/assets/IndexCreate.html-BB6YhLg4.js" as="script"><link rel="prefetch" href="/MdBlog/assets/AGTriggerSyncJobStatus.html-ldw7Kx8G.js" as="script"><link rel="prefetch" href="/MdBlog/assets/KeysetPagination.html-Bg2vlEWg.js" as="script"><link rel="prefetch" href="/MdBlog/assets/Page_offsetPerformance.html-WXXmqTro.js" as="script"><link rel="prefetch" href="/MdBlog/assets/SSMSConnectAG.html-BZou60i5.js" as="script"><link rel="prefetch" href="/MdBlog/assets/ExecProcedure.html-BY_ScPGW.js" as="script"><link rel="prefetch" href="/MdBlog/assets/usp_GetCDCQueryStartMode.html-zDcVGvX7.js" as="script"><link rel="prefetch" href="/MdBlog/assets/usp_GetCdcTableData.html-CRqbrIly.js" as="script"><link rel="prefetch" href="/MdBlog/assets/usp_UpdateNextCDCTraceData.html-gVYZVejU.js" as="script"><link rel="prefetch" href="/MdBlog/assets/CreateTable.html-B8bfMta-.js" as="script"><link rel="prefetch" href="/MdBlog/assets/GetDatabaseTableScript.html-DLqlDcSS.js" as="script"><link rel="prefetch" href="/MdBlog/assets/GetTablespace.html-BvR06mDQ.js" as="script"><link rel="prefetch" href="/MdBlog/assets/UpdateDifferentTable.html-aeAvRKZH.js" as="script"><link rel="prefetch" href="/MdBlog/assets/CreateUserIntheAlwayson.html-OPqI4kSr.js" as="script"><link rel="prefetch" href="/MdBlog/assets/GetServerSessionAndUserInfo.html-w0uGFlwS.js" as="script"><link rel="prefetch" href="/MdBlog/assets/404.html-Bfvhkotq.js" as="script"><link rel="prefetch" href="/MdBlog/assets/Valine.min-_LyT3bfY.js" as="script"><link rel="prefetch" href="/MdBlog/assets/giscus-aTimukGI-DWEKOTfS.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container series--no show-catalog"><header class="navbar-container not-open"><div class="navbar-inner"><div class="site-brand nav-item"><img class="logo" src="/MdBlog/logo.png" alt="Manifacturing Industry Blog"><a href="/MdBlog/" class="site-name can-hide">Manifacturing Industry Blog</a></div><div class="nav-item navbar-links-wrapper" style=""><div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div><nav class="navbar-links"><!--[--><div class="navbar-links__item"><a href="/MdBlog/" class="link" aria-label="Home"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Home<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/MdBlog/categories/Skills/1.html" class="link" aria-label="Skills"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Skills<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/MdBlog/categories/ELK/1.html" class="link" aria-label="ELK"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->ELK<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/MdBlog/categories/ETL/1.html" class="link" aria-label="ETL"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->ETL<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/MdBlog/categories/MES/1.html" class="link" aria-label="MES"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->MES<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/MdBlog/categories/WMS/1.html" class="link" aria-label="WMS"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->WMS<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/MdBlog/tags/SQLServer/1.html" class="link" aria-label="Tags"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Tags<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><div class="dropdown-link"><button class="dropdown-link__title" type="button" aria-label="Series"><span class="xicon-container left title"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Series<!--]--></span></span><span class="arrow down"></span></button><button class="dropdown-link--mobile__title" type="button" aria-label="Series"><span class="title"><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Series<!--]--></span></span></span><span class="right arrow"></span></button><ul class="dropdown-link__container" style="display:none;"><!--[--><li class="dropdown-link__item"><a href="/MdBlog/series/ETL/BasicProcessor/1Group" class="link" aria-label="ApacheNifi"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->ApacheNifi<!--]--></span></span><!--[--><!--]--></a></li><li class="dropdown-link__item"><a href="/MdBlog/series/Digitalization/SyncData/1Scope" class="link" aria-label="SyncData"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->SyncData<!--]--></span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--><!----><span class="xicon-container btn-toggle-dark-mode btn--dark-mode navbar-links__item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span><ul class="social-links navbar-links__item"><!--[--><!--]--></ul></nav><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div></div></header><!----><!----><!----><div class="theme-main" style=""><!----><!--[--><main class="page-container"><div class="page-content"><h1 class="page-title">Sync Job status in the SQL Server Alwayson cluster solution</h1><div class="page-info"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->json zhao<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2025/11/21<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/MdBlog/categories/Skills/1.html" class="">Skills</a><!--]--><!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M10 14a4 4 0 1 1 4-4a4.005 4.005 0 0 1-4 4zm0-6a2 2 0 1 0 1.998 2.004A2.002 2.002 0 0 0 10 8z" fill="currentColor"></path><path d="M16.644 29.415L2.586 15.354A2 2 0 0 1 2 13.941V4a2 2 0 0 1 2-2h9.941a2 2 0 0 1 1.414.586l14.06 14.058a2 2 0 0 1 0 2.828l-9.943 9.943a2 2 0 0 1-2.829 0zM4 4v9.942L18.058 28L28 18.058L13.942 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/MdBlog/tags/SQLServer/1.html" class="">SQLServer</a><!--]--><!--]--></span></span><!----></div><div class="theme-reco-md-content"><div><h2 id="sync-job-status-in-the-sql-server-alwayson-cluster-solution" tabindex="-1"><a class="header-anchor" href="#sync-job-status-in-the-sql-server-alwayson-cluster-solution"><span><strong>Sync Job status in the SQL Server Alwayson cluster solution</strong></span></a></h2><hr><h3 id="_1-scenario-requirement" tabindex="-1"><a class="header-anchor" href="#_1-scenario-requirement"><span>1. <strong>Scenario(<code>Requirement</code>)</strong></span></a></h3><p>In the SQL Server Availability Group(<code>AG</code>),when the AG changes failover,the primary server has become secondary server,in the meantime, the second server has become the primary server. In the master and slaver change roles.However, the CDC and other business jobs didn&#39;t register or run when the role changed. That&#39;s mean some businesses like PowerBI(<code>PB</code>) will stop, the sync data(<code>CDC</code>) will lose data. What should we do to stop this thing happened?</p><p><img src="/MdBlog/assets/Jobs-DeWL77gP.png" alt="Jobs"></p><hr><h3 id="_2-solution" tabindex="-1"><a class="header-anchor" href="#_2-solution"><span>2. <strong>Solution</strong></span></a></h3><p>We have two ways to prevent this thing happens.We have two options:</p><h4 id="_1-use-customer-stored-procedure-dbo-usp-checkprimaryserver-to-check-the-server-role-is-primary-or-not" tabindex="-1"><a class="header-anchor" href="#_1-use-customer-stored-procedure-dbo-usp-checkprimaryserver-to-check-the-server-role-is-primary-or-not"><span>1. Use customer stored procedure <code>dbo.usp_CheckPrimaryServer</code> to check the server role is primary or not.</span></a></h4><ul><li>Dupilcate all jobs in the all availability group.</li><li>Create the customer stored procedure <code>dbo.usp_CheckPrimaryServer</code></li></ul><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> dbo<span class="token punctuation">.</span>usp_CheckPrimaryServer</span>
<span class="line"><span class="token keyword">AS</span></span>
<span class="line"><span class="token keyword">BEGIN</span></span>
<span class="line">    <span class="token keyword">SET</span> NOCOUNT <span class="token keyword">ON</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">DECLARE</span> <span class="token variable">@CurrentRole</span> NVARCHAR<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">SELECT</span> <span class="token variable">@CurrentRole</span> <span class="token operator">=</span> role_desc </span>
<span class="line">    <span class="token keyword">FROM</span> sys<span class="token punctuation">.</span>dm_hadr_availability_replica_states </span>
<span class="line">    <span class="token keyword">WHERE</span> is_local <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    </span>
<span class="line">    <span class="token keyword">IF</span> <span class="token variable">@CurrentRole</span> <span class="token operator">IS</span> <span class="token boolean">NULL</span> <span class="token operator">OR</span> <span class="token variable">@CurrentRole</span> <span class="token operator">&lt;&gt;</span> <span class="token string">&#39;PRIMARY&#39;</span></span>
<span class="line">    <span class="token keyword">BEGIN</span></span>
<span class="line">        <span class="token keyword">DECLARE</span> <span class="token variable">@Message</span> NVARCHAR<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token keyword">SET</span> <span class="token variable">@Message</span> <span class="token operator">=</span> N<span class="token string">&#39;x  Current server is not PRIMARY server,stop job&#39;</span><span class="token punctuation">;</span></span>
<span class="line">        </span>
<span class="line">        THROW <span class="token number">50001</span><span class="token punctuation">,</span><span class="token variable">@Message</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">END</span></span>
<span class="line">    <span class="token keyword">PRINT</span> N<span class="token string">&#39;✓ Current server is PRIMARY server，continue job&#39;</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">RETURN</span> <span class="token number">0</span><span class="token punctuation">;</span> </span>
<span class="line"><span class="token keyword">END</span></span>
<span class="line">GO</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-grant-user-access" tabindex="-1"><a class="header-anchor" href="#_2-grant-user-access"><span>2. grant user access</span></a></h4><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">USE</span> master<span class="token punctuation">;</span></span>
<span class="line">GO</span>
<span class="line"><span class="token comment">-- grant the user view STATE permission</span></span>
<span class="line"><span class="token keyword">GRANT</span> <span class="token keyword">VIEW</span> SERVER STATE <span class="token keyword">TO</span> <span class="token punctuation">[</span>YourUser<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">-- grant the user view permission</span></span>
<span class="line"><span class="token keyword">GRANT</span> <span class="token keyword">VIEW</span> <span class="token keyword">ANY</span> DEFINITION <span class="token keyword">TO</span> <span class="token punctuation">[</span>YourUser<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">GRANT</span> <span class="token keyword">VIEW</span> SERVER PERFORMANCE STATE <span class="token keyword">TO</span> <span class="token punctuation">[</span>YourUser<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Each job step will add <code>Exec dbo.usp_CheckPrimaryServer</code> as first step</li><li>If the server is primary server, go to next step;otherwise,exit.</li></ul><hr><h4 id="_3-deal-with-cdc-job" tabindex="-1"><a class="header-anchor" href="#_3-deal-with-cdc-job"><span>3. <strong>Deal with CDC job</strong></span></a></h4><ol><li>You must enable CDC job in the secondary database. Because the CDC configuration data saved in the <code>msdb</code> database. We add your db in the failover, we never add <code>msdb</code>.</li><li>In the CDC Jobs <code>cdc.ReportCenter_capture</code> and <code>cdc.ReportCenter_cleanup</code>， you also need add the first step to check current db is primary db or not;</li></ol><h3 id="_3-summarize" tabindex="-1"><a class="header-anchor" href="#_3-summarize"><span>3.<strong>Summarize</strong></span></a></h3><ol><li><p>Limitation</p><ul><li>Each job need add this step,it doesn&#39;t has central control;</li><li>Each job in the AG will generate some unuse messsage;</li><li><strong><code>CDC job</code></strong> need special configuration.</li></ul></li><li><p>Benefit</p><ul><li>Simple configurate. Less job is best way;</li></ul></li></ol></div></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Last Updated 2025/12/16 16:10:35<!--]--></span></span></div></footer><!----><!----></div><div class="page-catalog-container"><h5 class="tip">ON THIS PAGE</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/MdBlog/blogs/Skills/SQLServer/Job/SyncJobAG.html#sync-job-status-in-the-sql-server-alwayson-cluster-solution" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Sync Job status in the SQL Server Alwayson cluster solution"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Sync Job status in the SQL Server Alwayson cluster solution<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/MdBlog/blogs/Skills/SQLServer/Job/SyncJobAG.html#_1-scenario-requirement" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="1. Scenario(Requirement)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->1. Scenario(Requirement)<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/MdBlog/blogs/Skills/SQLServer/Job/SyncJobAG.html#_2-solution" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2. Solution"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2. Solution<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/MdBlog/blogs/Skills/SQLServer/Job/SyncJobAG.html#_3-summarize" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="3.Summarize"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->3.Summarize<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--]--></ul></div></main><!--]--></div></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/MdBlog/assets/app-BbnCYvRy.js" defer></script>
  </body>
</html>
